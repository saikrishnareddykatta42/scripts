---
- name: Install Tomcat
  hosts: all
  become: yes

  tasks:
  - name: Install Java
    apt:
      name: default-jre
      state: present

  - name: Download and extract Tomcat
    get_url:
      url: https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.54/bin/apache-tomcat-9.0.54.tar.gz
      dest: /tmp/apache-tomcat-9.0.54.tar.gz

  - name: Extract Tomcat
    unarchive:
      src: /tmp/apache-tomcat-9.0.54.tar.gz
      dest: /opt
      remote_src: yes
      creates: /opt/apache-tomcat-9.0.54

  - name: Set Tomcat permissions
    file:
      path: /opt/apache-tomcat-9.0.54
      state: directory
      owner: "{{ ansible_user }}"
      group: "{{ ansible_user }}"
      mode: '0755'

  - name: Start Tomcat
    systemd:
      name: tomcat
      state: started
      enabled: yes
